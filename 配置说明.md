# 配置说明

## 推荐的配置方法

此项目采用环境变量和 Cloudflare 控制台配置方式，避免在代码中存储敏感信息。

### 1. wrangler.toml 最小化配置
```toml
name = "r2-proxy"  # 此名称在网页部署时会被覆盖
main = "index.js"
compatibility_date = "2023-07-01"

# 环境变量和绑定配置在 Cloudflare 控制台中设置，无需在此文件中指定
```

### 2. 环境变量配置（在 Cloudflare 控制台中设置）
- `R2_BUCKET_NAME`: 您的 R2 存储桶名称
- `PROXY_SECRET`: 访问受保护文件的密钥，必须使用强密码
- `RATE_LIMIT_WINDOW`: 速率限制窗口（可选，默认为 900 秒）
- `MAX_REQUESTS_PER_WINDOW`: 每个时间窗口内允许的最大请求数（可选，默认为 100）

### 3. 服务绑定配置（在 Cloudflare 控制台中设置）
- **R2 绑定**：
  - Variable name: `R2_BUCKET`
  - Service: 选择您创建的 R2 存储桶
- **KV 命名空间绑定**：
  - Variable name: `RATE_LIMIT_KV`
  - KV namespace: 选择您创建的 KV 命名空间

### 4. 部署配置
- 构建命令：`npm install`
- 构建环境：`npm`

## 环境变量说明

### 必需的环境变量
- `R2_BUCKET_NAME`: 指定要访问的 R2 存储桶名称
- `PROXY_SECRET`: 用于访问受保护资源的密钥

### 可选的环境变量
- `RATE_LIMIT_WINDOW`: 速率限制时间窗口（单位：秒，默认 900，即 15 分钟）
- `MAX_REQUESTS_PER_WINDOW`: 每个时间窗口内的最大请求数（默认 100）

## 如何获取这些值

### 创建并获取 R2 存储桶名称
1. 在 Cloudflare 控制面板中进入 R2 部分
2. 点击"Create bucket"
3. 输入存储桶名称并创建

### 创建并获取 KV 命名空间 ID
1. 在 Cloudflare 控制面板中进入"Workers & Pages" > "KV"
2. 点击"Create a namespace"
3. 输入名称并创建
4. 复制生成的 ID

## 安全建议

### 密钥设置
- 使用至少 12 个字符的强密码
- 包含大小写字母、数字和特殊字符
- 定期更换密钥
- 示例强密码：`MySecureKey2025!@#`

### 速率限制配置
- 对于低流量网站：`MAX_REQUESTS_PER_WINDOW = "50"`
- 对于中等流量网站：`MAX_REQUESTS_PER_WINDOW = "100"`
- 对于高流量网站：`MAX_REQUESTS_PER_WINDOW = "200"`

## 优势

采用这种配置方式的优势：
- 避免在代码中存储敏感信息
- 避免部署时的账户 ID 和 Worker 名称不匹配错误
- 更容易管理和更新配置
- 更安全的部署流程